---
title: "wf_03_prime 工作流导航指南"
description: "后续工作路径选择、决策矩阵和工作流示例"
type: "技术设计"
status: "完成"
priority: "高"
created_date: "2025-11-27"
last_updated: "2025-11-27"
related_documents:
  - "../../wf_03_prime.md"
  - "doc_maintenance_workflows.md"
  - "../../KNOWLEDGE.md"
related_code: []
---

# wf_03_prime 工作流导航指南

本文档说明 `/wf_03_prime` 后的工作流路径选择、决策指南和实现规范。

---

## 📌 工作流位置指示

当使用此命令时，你正在执行标准开发流程的以下阶段：

```
[项目启动] → [任务规划] → [加载上下文 ← 当前] → [架构咨询] → [代码实现] → [测试验证] → [代码审查] → [提交保存]
  STEP 0       STEP 0.5        STEP 1                STEP 2       STEP 3       STEP 4       STEP 5      STEP 6
```

### ✅ 已完成的步骤

在执行 `/wf_03_prime` 前，通常已经完成：

1. ✅ **项目启动** (STEP 0) - 项目规划已完成 (`/wf_01_planning`)
2. ✅ **任务规划** (STEP 0.5) - 任务列表已生成 (`/wf_02_task`)
   - 或者：直接从 `/clear` 后恢复工作（重新加载上下文）

### 📝 当前步骤

**正在执行**: `/wf_03_prime` (加载项目上下文)

**这个命令的职责**：
- 读取项目管理文档（PRD.md, PLANNING.md, TASK.md, CONTEXT.md, KNOWLEDGE.md）
- 恢复会话状态和工作上下文
- 智能加载技术文档（基于当前任务相关性）
- 推荐下一步优先任务
- 为后续工作做好准备

### ⏭️ 建议下一步

**任务创建/更新完成后**，根据项目状态选择下一步：

#### 路径 1️⃣：有明确的建筑咨询需求 ✅
```bash
# 当前: 已加载项目上下文
# 下一步: 架构咨询或技术决策

/wf_04_ask "具体的技术问题或架构咨询"

# 后续: 基于咨询结果执行开发
/wf_05_code "开始功能实现"
```
**适用场景**: 需要在编码前进行技术验证、架构决策、或获取设计指导

#### 路径 2️⃣：直接开始编码实现 ✨
```bash
# 当前: 已加载项目上下文
# 下一步: 直接实现功能

/wf_05_code "实现指定的功能或任务"

# 后续: 测试和审查
/wf_07_test "功能测试验证"
/wf_08_review "代码审查"
/wf_11_commit "提交代码"
```
**适用场景**: 任务明确，不需要额外咨询，可以直接开始编码

#### 路径 3️⃣：更新任务状态后继续工作 📋
```bash
# 当前: 已加载项目上下文
# 下一步: 更新当前任务状态

/wf_02_task update "标记当前任务为活跃或更新进度"

# 然后: 根据任务选择路径1或路径2
/wf_04_ask "..." 或 /wf_05_code "..."
```
**适用场景**: 需要明确标记当前工作任务，确保任务追踪的连续性

---

## 📊 工作流进度提示

当你完成上下文加载时，确保输出中包含：

✅ 已完成:
- 项目需求和目标（来自 PRD.md）
- 项目架构和技术栈（来自 PLANNING.md）
- 当前任务列表和优先级（来自 TASK.md）
- 上一个会话的进度（来自 CONTEXT.md）
- 知识库和设计决策（来自 KNOWLEDGE.md）
- 相关的技术文档清单（来自文档索引）

⏭️ 下一步提示:
- 建议执行的命令（基于当前任务和项目状态）
- 推荐的工作流路径（3个选项之一）
- 当前任务的详细说明和验收标准

---

## 💡 决策指南

**我应该执行哪个路径？**

| 情况 | 建议 | 命令 |
|------|------|------|
| 需要技术决策或架构讨论 | 路径 1 | /wf_04_ask → /wf_05_code |
| 任务明确，直接编码 | 路径 2 | /wf_05_code → /wf_07_test → /wf_08_review → /wf_11_commit |
| 需要更新任务状态 | 路径 3 | /wf_02_task update → 路径1或路径2 |
| 发现问题需要调试 | 特殊 | /wf_06_debug → /wf_07_test → /wf_11_commit |
| 不确定下一步 | 推荐 | 先执行 /wf_02_task update，再选择路径 |

---

## 🧠 智能推荐输出规范

### 提取算法

当生成"💡 智能推荐下一步"部分时，应按以下步骤操作：

1. **读取 TASK.md**
   - 定位到"## 🚀 下一步优先任务"部分
   - 检查是否存在"进行中的任务"（marked as `[⏳]` 或 `[进行中]`）

2. **任务选择逻辑**
   ```
   if 有进行中的任务:
       当前任务 = 进行中的任务
       状态 = "进行中"
       显示: 任务名 + 当前步骤进度 + 下一步建议
   else if 有待做任务:
       当前任务 = 优先级最高的待做任务 (第一个)
       状态 = "待开始"
       显示: 任务名 + 完整命令序列 + 验收标准
   else:
       显示: "所有待做任务已完成！" + 项目统计信息
   ```

3. **信息提取**
   - **任务标题**: 从"#### 任务 X️⃣：[名称]"提取
   - **优先级**: 从"[🔴 高优先级]"或"[🟠 中优先级]"提取
   - **预计时间**: 从"预计时间: X分钟"提取
   - **工作流位置**: 从"工作流位置: [...]"提取
   - **为什么优先**: 从"为什么优先:"提取
   - **命令序列**: 从"推荐命令序列"中的 bash 代码块提取
   - **验收标准**: 从"验收标准:"后的列表提取

4. **输出格式**
   - 使用 markdown 格式，清晰的层级结构
   - 使用 emoji 标记（✅、🔴、🟠、⏳、→ 等）
   - 使用代码块显示命令序列
   - 使用复选框 `[ ]` 显示验收标准

### 验证检查表

生成输出前，验证以下内容：

- [ ] 从 TASK.md 正确读取了任务信息
- [ ] 优先级标记准确（🔴 高、🟠 中、🟡 低）
- [ ] 命令序列完整且正确（包含所有步骤）
- [ ] 工作流位置标记清晰
- [ ] 验收标准可验证（不含歧义）
- [ ] 如果有多个待做任务，列出其他任务的简表
- [ ] 输出清晰易读，符合中文文档规范

### 错误处理

- **TASK.md 格式不匹配**: 提示用户"检查 TASK.md 格式是否符合标准"
- **没有待做任务**: 显示"项目任务已全部完成！"并询问用户是否需要进入下一阶段
- **任务信息不完整**: 显示可用信息，并标记缺失的部分

---

## 实现示例

### 场景 1：P1 阶段完成，进入 P2 规划

**项目状态**：
- P1 阶段：100% 完成（所有功能实现测试）
- P2 阶段：规划中（待定义任务）

**改进后的 /wf_03_prime 输出示例**：

```
## 💡 智能推荐下一步

### ✅ **优先推荐**（基于 TASK.md 待做任务）

**任务**: 完善脚本类型注解 🔴 高优先级
- 预计时间: 30分钟
- 工作流位置: [准备阶段] → [代码实现] → [审查] → [提交]
- 为什么优先: 提高 IDE 支持和代码可维护性，为后续单元测试打基础

**推荐立即执行以下命令序列**:
```bash
# 第1步: 确认任务并标记为活跃
/wf_02_task update "完善脚本类型注解"

# 第2步: 代码实现 (主要工作)
/wf_05_code "为 ~/.claude/commands/scripts/frontmatter_utils.py 添加完整类型注解"

# 第3步: 代码审查
/wf_08_review

# 第4步: 提交并保存进度
/wf_11_commit "feat: 完善脚本类型注解"
```

**验收标准** (完成后可验证):
- [ ] 所有函数/方法都有完整的类型注解
- [ ] 修正 `any` → `Any` (大写)
- [ ] 代码审查通过
- [ ] 提交到仓库

**📊 工作流进度**:
- 当前: 项目上下文加载完成
- 下一步: 执行上述命令序列
- 工作流位置: [加载阶段] → [任务执行] → [验收] → [提交]

### 📋 其他待做任务 (优先级顺序)
2. 增强脚本错误处理 (🔴 高优先级, 45分钟)
3. 添加单元测试 (🟠 中优先级, 2小时)
```

### 场景 2：某个任务进行中，显示下一步

**项目状态**：
- 当前任务：完善脚本类型注解 (进行中 ⏳)

**改进后的 /wf_03_prime 输出**：

```
## 💡 智能推荐下一步

### ✅ **当前任务进度**

**任务**: 完善脚本类型注解 🔴 高优先级
- 状态: 进行中 ⏳ (第2步/4步)
- 工作流位置: [准备阶段] → [代码实现 ← 当前] → [审查] → [提交]

**建议继续执行**:
```bash
# 当前完成: /wf_02_task update "..."
# 当前完成: /wf_05_code "..."
# 下一步:
/wf_08_review

# 然后:
/wf_11_commit "feat: 完善脚本类型注解"
```

**📊 工作流进度**:
- 已完成: 任务确认 + 代码实现
- 下一步: 代码审查
- 工作流位置: [加载] → [执行] → [验收 ← 当前] → [提交]
```

---

**See Also**:
- [wf_03_prime.md](../../wf_03_prime.md) - 主命令文档
- [wf_03_prime_mcp_serena.md](wf_03_prime_mcp_serena.md) - MCP Serena 增强指南
- [doc_maintenance_workflows.md](doc_maintenance_workflows.md) - 文档维护工作流
- [KNOWLEDGE.md](../../KNOWLEDGE.md) - 知识库索引
