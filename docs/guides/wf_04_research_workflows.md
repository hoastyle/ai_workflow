---
title: "wf_04_research 工作流和决策指南"
description: "深度研究后的工作流路径选择、决策矩阵和实现规范"
type: "技术设计"
status: "完成"
priority: "高"
created_date: "2025-11-27"
last_updated: "2025-11-27"
related_documents:
  - "../../wf_04_research.md"
  - "wf_04_research_mcp_guide.md"
  - "../../KNOWLEDGE.md"
related_code: []
---

# wf_04_research 工作流和决策指南

本文档说明 `/wf_04_research` 深度研究完成后的工作流路径选择、决策规范和实现要点。

---

## 📌 工作流位置指示

当使用此命令时，你正在执行标准开发流程的以下阶段：

```
[启动] → [规划] → [加载] → [咨询] → [深度研究 ← 当前] → [实现] → [测试] → [审查] → [提交]
STEP 0   STEP 0.5   STEP 1   STEP 2     STEP 2.5              STEP 3   STEP 4   STEP 5   STEP 6
```

### 已完成的步骤

在执行 `/wf_04_research` 前，通常已经完成：

1. ✅ **项目启动** (STEP 0) - 项目规划已完成 (`/wf_01_planning`)
2. ✅ **任务规划** (STEP 0.5) - 任务列表已生成 (`/wf_02_task`)
3. ✅ **加载上下文** (STEP 1) - 项目上下文已加载 (`/wf_03_prime`)
4. ✅ **初步咨询** (STEP 2) - 已执行快速架构咨询 (`/wf_04_ask`)，确定需要深度研究

### 当前步骤

**正在执行**: `/wf_04_research <TECH_TOPIC>` (开源方案深度研究)

**这个命令的职责**：
- 系统化发现相关的开源项目（5+ 个候选方案）
- 从 5 个维度深度评估每个方案（功能、社区、技术、成本、License）
- 创建详细的方案对比矩阵
- 给出明确的推荐和决策理由
- 更新 KNOWLEDGE.md 中的方案对比表
- 为重大决策创建 ADR 记录

---

## 工作流进度提示

当你完成深度研究时，确保输出中包含：

✅ 已完成:
- 发现了 5+ 个相关开源方案
- 为每个方案创建了完整的 5 维度评估
- 创建了对比矩阵方便决策
- 给出了明确的推荐和推荐理由
- 识别了风险和缓解措施
- 更新了 KNOWLEDGE.md 中的方案对比表
- [重大决策] 记录了是否需要创建 ADR

⏭️ 下一步提示:
- 建议执行的路径（4 个选项之一）
- 是否需要 PoC 验证
- 是否需要创建 ADR
- 预计的集成成本和时间表

---

## 深度研究完成后的 4 条工作流路径

### 路径 1️⃣：直接更新规划并实现 ✅

**适用场景**: 研究推荐明确，无需进一步验证，可以直接更新规划

```bash
# 当前: 研究完成，推荐方案明确
# 下一步: 更新项目规划

/wf_01_planning "根据研究结果更新技术栈决策"

# 然后: 重新加载上下文
/wf_03_prime

# 最后: 开始实现
/wf_05_code "实现已决策的功能"
```

**何时选择**:
- 推荐方案的可行性无疑虑
- 团队对方案已有使用经验
- 集成成本和风险评估都符合预期
- 没有发现重大的兼容性问题

**工作流位置**: STEP 2.5 → STEP 3

---

### 路径 2️⃣：PoC 验证后确认方案 🧪

**适用场景**: 研究完成，但需要验证方案可行性

```bash
# 当前: 研究完成，但需要验证方案可行性
# 下一步: 创建概念验证

/wf_05_code "实现推荐方案的 PoC 原型"

# 验证 PoC 可行性
/wf_07_test "测试 PoC 功能和性能"

# 基于验证结果确认
/wf_04_ask "确认 PoC 结果，最终决策"

# 最后: 更新规划并开始正式实现
/wf_01_planning "根据验证结果更新技术栈"
/wf_05_code "开始正式实现"
```

**何时选择**:
- 推荐方案是团队首次使用的技术
- 方案涉及系统架构的关键部分
- 方案有性能或兼容性的不确定因素
- 团队对方案的可行性有疑虑
- 集成成本存在较大不确定性

**工作流位置**: STEP 2.5 → STEP 3 → STEP 4 → STEP 2 → STEP 3

**所需步骤**:
- [ ] 创建 PoC 原型代码
- [ ] 测试基本功能
- [ ] 测试性能指标
- [ ] 评估集成成本
- [ ] 验证与现有系统的兼容性

---

### 路径 3️⃣：需要进一步咨询和讨论 💬

**适用场景**: 研究完成，但有新问题或需要架构师讨论

```bash
# 当前: 研究完成，但有新问题或需要架构师讨论
# 下一步: 回到咨询阶段

/wf_04_ask "基于研究结果进行进一步的架构决策讨论"

# 根据咨询结果选择:
# - 直接实现 → /wf_05_code
# - 需要其他方案 → /wf_04_research
# - 更新规划 → /wf_01_planning
```

**何时选择**:
- 研究揭示了新的架构选项或权衡
- 多个方案各有优缺点，需要讨论
- 发现了意外的复杂性或风险
- 需要调整项目需求或约束条件
- 团队对推荐方案有保留意见

**工作流位置**: STEP 2.5 → STEP 2 → (根据咨询结果选择下一步)

---

### 路径 4️⃣：创建 ADR 记录重大决策 📋

**适用场景**: 完成深度研究，确认重大技术决策

```bash
# 当前: 完成深度研究，确认重大技术决策
# 下一步: 记录决策过程

# 创建 ADR (参考 docs/adr/TEMPLATE.md)
# docs/adr/YYYY-MM-DD-technology-selection.md

# ADR 内容应包括：
# - 背景和问题陈述
# - 评估的候选方案
# - 决策理由和权衡分析
# - 采纳和拒绝的原因
# - 后续行动和影响

# 然后: 更新规划
/wf_01_planning "更新基于 ADR 的技术栈决策"

# 最后: 开始实现
/wf_05_code "实现已决策的功能"
```

**何时选择**:
- 决策涉及技术栈的关键组件替换
- 决策影响系统长期的架构和可维护性
- 决策有多个可行方案且权衡复杂
- 决策与现有标准或架构有较大偏差
- 团队需要记录决策背景和理由供未来参考

**工作流位置**: STEP 2.5 → (创建 ADR) → STEP 0-1 → STEP 3

**ADR 关键内容**:
- [ ] 标题清晰表达决策内容
- [ ] 背景说明为什么需要这个决策
- [ ] 描述评估的所有候选方案
- [ ] 明确记录选中的方案和原因
- [ ] 列出权衡和考虑的因素
- [ ] 记录后续行动和验收标准

---

## 💡 决策指南矩阵

| 研究结果 | 推荐路径 | 建议命令 | 关键决策点 |
|---------|---------|---------|----------|
| **推荐明确，无疑虑** | 路径 1 | /wf_01_planning → /wf_05_code | 信息充分，可直接推进 |
| **有技术风险需验证** | 路径 2 | /wf_05_code (PoC) → /wf_07_test | 需要原型验证 |
| **方案权衡复杂** | 路径 3 | /wf_04_ask → 根据结果选择 | 需要深度讨论 |
| **重大技术决策** | 路径 4 | 创建 ADR → /wf_01_planning | 需要记录背景和理由 |
| **有其他疑虑** | 混合 | 路径 2 + 路径 4 | PoC 验证 + ADR 记录 |
| **发现现有更好** | 特殊 | /wf_04_ask "确认是否改变决策" | 需要确认权衡 |

---

## 何时需要 PoC 验证？

✅ **应该创建 PoC**:
- 推荐方案是团队首次使用的新技术
- 方案涉及系统架构的关键部分（如数据库、中间件等）
- 方案有性能或兼容性的不确定因素
- 团队对方案的可行性有疑虑
- 集成成本存在较大不确定性
- 需要验证与现有系统的兼容性

❌ **不需要 PoC**:
- 团队已有同类技术的成熟使用经验
- 方案是久经考验的标准化解决方案
- 集成只涉及配置而非代码修改
- 研究充分消除了所有疑虑

---

## 何时需要创建 ADR？

✅ **应该创建 ADR**:
- 决策涉及技术栈的关键组件替换
- 决策影响系统的长期架构和可维护性
- 决策有多个可行方案且权衡复杂
- 决策与现有标准或架构有较大偏差
- 需要记录决策背景供未来参考（如团队变更、需求回溯等）

❌ **不需要 ADR**:
- 只是替换同类技术的升级版本
- 决策是显而易见的，无需记录理由
- 这是执行临时性的改动或实验

**参考**: `docs/adr/TEMPLATE.md` 和 `docs/adr/README.md`

---

## 输出检查清单

完成深度研究时，验证输出包含以下内容：

### 研究总结部分
- [ ] 研究的技术主题清晰定义
- [ ] 评估的候选方案数量（应 ≥ 5 个）
- [ ] 最终推荐方案明确指出
- [ ] 推荐指数给出（星级评分）

### 需求和评估标准部分
- [ ] 明确的功能需求列表
- [ ] 非功能性需求说明（性能、可维护性等）
- [ ] 项目特定的约束条件记录

### 候选方案评估部分
- [ ] 每个方案都有基本信息（GitHub、版本、许可证）
- [ ] 功能评估使用符号清晰表达（✅/⚠️/❌）
- [ ] 社区活跃度用颜色指示（🟢/🟡/🔴）
- [ ] 技术质量和集成成本明确评分
- [ ] 优势和劣势列表完整

### 对比矩阵部分
- [ ] 使用表格对比关键维度
- [ ] 优势和劣势突出显示
- [ ] 每个方案的权衡清晰表述

### 推荐方案部分
- [ ] 推荐方案名称和理由清晰
- [ ] 风险和缓解措施列出
- [ ] 备选方案及其适用场景说明
- [ ] 后续步骤（PoC/ADR/直接实现）建议

### 文档更新部分
- [ ] KNOWLEDGE.md 中的方案对比表已更新
- [ ] [重大决策] 记录了 ADR 创建需求
- [ ] 关联任务已在 TASK.md 中创建

---

## 相关内容

详见:
- [wf_04_research.md](../../wf_04_research.md) - 主命令文档
- [wf_04_research_mcp_guide.md](wf_04_research_mcp_guide.md) - MCP 增强详解
- [KNOWLEDGE.md](../../KNOWLEDGE.md) - 知识库和决策记录
- [docs/adr/TEMPLATE.md](../../docs/adr/TEMPLATE.md) - ADR 模板
- [docs/adr/README.md](../../docs/adr/README.md) - ADR 指南
