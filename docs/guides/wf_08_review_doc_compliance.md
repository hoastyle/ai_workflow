---
title: "代码审查 - 文档架构合规性检查"
description: "Dimension 6 完整检查清单：分层、成本控制、Frontmatter、内容重复、指针关系、审查合规"
type: "参考"
status: "完成"
priority: "高"
created_date: "2025-12-09"
last_updated: "2025-12-09"
related_documents:
  - "wf_08_review.md"
  - "docs/reference/FRONTMATTER.md"
  - "KNOWLEDGE.md"
related_code: []
tags: ["code-review", "documentation", "compliance", "checklist"]
authors: ["Claude"]
version: "1.0"
---

# 文档架构合规性检查 (Dimension 6)

## 概述

**目的**: 确保代码和文档同步，遵循分层约束，成本控制

**适用场景**: 代码审查中的文档质量检查（Dimension 6）

**检查清单** (所有 YES 才能通过此维度):

---

## 1. 分层正确性

**检查项**: 新文档是否在正确的层级？

### 四层架构
- **管理层**: PLANNING.md, CONTEXT.md
- **技术层**: docs/
- **知识层**: KNOWLEDGE.md, docs/knowledge/
- **归档层**: docs/archive/

### 检查标准

✅ **通过示例**:
- 新 API 文档在 `docs/api/`
- 新决策在 `docs/adr/`
- 常见问题在 `KNOWLEDGE.md`

❌ **反例**:
- 常见 FAQ 出现在 `docs/api/` 中
- 应该在: `KNOWLEDGE.md § FAQ`

---

## 2. 成本控制

**检查项**: 文档大小是否符合约束？

### 约束标准

#### KNOWLEDGE.md 大小
- ❌ 如果增长 > 20% → 拆分关键部分到 `docs/knowledge/`
- ✅ 增长 < 20% → 通过

#### 新技术文档
- ❌ 如果 > 500 行 → 要求拆分成多个文件
- ✅ < 500 行 → 通过

#### 新 ADR
- ❌ 如果 > 200 行 → 要求精简
- ✅ < 200 行 → 通过

#### docs/ 总增长
- ❌ 如果 > 30% → 检查是否需要清理旧文档
- ✅ < 30% → 通过

---

## 3. Frontmatter 完整性

**检查项**: 所有新文档是否有元数据？

### 必需字段 (7个)

```yaml
---
title: "文档标题"
description: "一句话描述"
type: "技术设计 | API参考 | 教程 | ..."
status: "草稿 | 完成 | 待审查"
priority: "高 | 中 | 低"
created_date: "2025-12-09"
last_updated: "2025-12-09"
---
```

### 检查标准

❌ **拒绝情况**:
- 缺失任何必需字段

✅ **通过情况**:
- 全部 7 个字段存在
- 字段: `title`, `description`, `type`, `status`, `priority`, `created_date`, `last_updated`

### 关系字段

❌ **标记改进**:
- `related_documents`/`related_code` 为空或过时

✅ **通过**:
- 相关链接准确

### 类型规范

❌ **拒绝**:
- `type` 字段不在允许的值中

✅ **通过**:
- `type` 字段符合规范

**允许的 type 值**: 技术设计, 系统集成, API参考, 教程, 故障排查, 架构决策, 参考

---

## 4. 内容重复检查

**检查项**: 是否有内容在多个文档重复？

### 信号 1: 类似说明出现在 2+ 个地方

❌ **重复内容** → 要求建立指针关系
✅ **内容独立，无重复** → 通过

### 信号 2: KNOWLEDGE.md FAQ 和 docs/ 文档说同一个事

❌ **重复说明** → 删除一个，保留指针
✅ **各有特点，互补而非重复** → 通过

### 信号 3: ADR 和 PLANNING.md 有相同决策记录

❌ **重复记录** → 精简一个
✅ **PLANNING.md 记录"是什么"，ADR 记录"为什么"** → 通过

---

## 5. 指针而非复制

**检查项**: 是否建立了正确的文档关系？

### 跨层引用

❌ **PLANNING.md 和 docs/ 是孤立的** → 要求补充链接
✅ **PLANNING.md 有指向 docs/ 的链接** → 通过

### 索引更新

❌ **新文档未在 KNOWLEDGE.md 索引表中** → 拒绝
✅ **索引已更新** → 通过

### 关系图

❌ **Frontmatter 中没有关系链接** → 标记改进
✅ **关系清晰** → 通过

---

## 6. 审查合规

**检查项**: 文档内容质量和准确性

### 内容真实性

❌ **文档说明与代码不符** → 拒绝
✅ **文档准确反映代码** → 通过

### 代码示例

❌ **API 文档没有使用示例** → 要求补充
✅ **有清晰的代码示例** → 通过

### 风格一致性

❌ **格式与项目其他文档明显不一致** → 要求调整
✅ **风格一致** → 通过

---

## 审查评分

### 评分等级

```
评分等级          条件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
5/5 (优秀)      所有 6 项检查通过，示范级别
4/5 (良好)      通过所有关键项 (分层、成本、Frontmatter)
                仅有微小改进
3/5 (及格)      基本符合约束，有改进空间
2/5 (需改进)    有 2+ 项不符合，需要显著调整
1/5 (拒绝)      严重违反约束，无法通过
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 失败处理

### 🔴 立即拒绝（必须修复）

- KNOWLEDGE.md 增长 > 50%
- 新文档无 Frontmatter
- 内容重复在 2+ 个地方
- 文档内容与代码不符

### 🟠 要求改进（可以在下个 commit 修复）

- KNOWLEDGE.md 增长 20-50%（需解释为什么）
- 文档 > 500 行（需分拆）
- Frontmatter 缺少推荐字段
- 没有链接到相关文档

---

## 修复方式

如果文档审查不通过，返回 Step 8 (在 `/wf_05_code` 中) 或使用：

```bash
/wf_14_doc --check "docs/"  # 快速检查文档问题
/wf_14_doc --fix "docs/"    # 自动修复可修复的问题
```

---

## 输出模板

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Dimension 6: 文档架构合规性
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
├─ 分层正确性:  ✅/❌
├─ 成本控制:    ✅/❌
├─ Frontmatter: ✅/❌
├─ 内容重复:    ✅/❌
├─ 指针关系:    ✅/❌
├─ 审查合规:    ✅/❌
└─ 综合评分:    __/5
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

代码审查通过 (Dim 1-5) AND 文档审查通过 (Dim 6) = ✅ APPROVED
```

---

**创建日期**: 2025-12-09
**版本**: 1.0
**维护者**: AI Workflow Team
