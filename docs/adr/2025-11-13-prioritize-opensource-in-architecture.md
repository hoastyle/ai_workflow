---
title: "在架构咨询工作流中优先考虑开源方案"
date: 2025-11-13
status: "Accepted"
philosophy: ["Think Different", "Simplify Ruthlessly", "Craft, Don't Code"]
impact: "high"
---

## 背景

### 问题陈述

在系统构建和规划过程中，团队倾向于优先考虑自行实现解决方案，而非系统性地评估和使用成熟的开源方案。这导致：

1. **时间浪费**: 重复实现已有的功能，浪费开发时间
2. **质量风险**: 自行实现往往缺少开源项目的成熟度和社区支持
3. **维护成本**: 自行实现的方案需要长期维护和迭代
4. **工作流缺陷**: 架构咨询流程中没有系统化的"开源方案研究"步骤

### 约束条件

- 项目需要支持快速迭代和决策制定
- 工作流系统必须易于使用，降低学习成本
- 必须与现有的架构咨询流程 (/wf_04_ask) 无缝集成
- 技术选型决策需要持久化记录，便于未来参考

## 选项分析

### 选项 A: 仅更新 /wf_04_ask，无专门命令

**描述**: 在现有的架构咨询命令中添加"开源方案调研"步骤，不创建新的独立命令。

**优势**:
- 实现成本低，只需修改一个文件
- 用户学习曲线短，命令数量没有增加
- 简单直接，符合"Simplify Ruthlessly"原则

**劣势**:
- 对于深度技术研究，功能不够详细
- 无法系统性地对比多个方案
- 对于复杂决策，输出格式可能过于简洁
- 缺少专业的评估矩阵和对比工具

**成本估计**: 30分钟 (修改 /wf_04_ask.md)

### 选项 B: 创建独立的 /wf_04_research 命令

**描述**: 创建专门用于深度开源方案评估的新命令，支持系统化的研究、对比和决策记录。

**优势**:
- 提供专业的评估框架和详细的对比矩阵
- 支持五维度评估（功能、社区、技术质量、License、成本）
- 生成结构化的对比表格，方便团队决策
- 自动更新 KNOWLEDGE.md，建立长期知识库
- 对于复杂的技术选型，支持更深入的分析

**劣势**:
- 实现成本较高，需要创建完整的新命令文件
- 增加了项目命令数量，可能增加用户困惑
- 仅在需要深度研究时使用，轻量级决策可能过度复杂

**成本估计**: 2.5小时 (创建 wf_04_research.md, 编写详细过程和输出格式)

### 选项 C: 混合方案 - 更新 /wf_04_ask + 创建 /wf_04_research

**描述**: 在 /wf_04_ask 中添加基础的开源方案调研步骤，同时创建 /wf_04_research 作为深度研究工具。根据决策复杂度，用户可选择快速评估或深度研究。

**优势**:
- 满足两种场景：快速决策 (使用 /wf_04_ask) 和深度研究 (使用 /wf_04_research)
- 用户可以灵活选择工具深度
- 符合工作流的分层设计理念
- 充分利用两个工具的优势

**劣势**:
- 实现成本最高，需要修改两个文件并创建新命令
- 可能导致用户在两个工具间选择困惑
- 维护负担相对较大

**成本估计**: 3.5小时 (修改 /wf_04_ask.md + 创建 wf_04_research.md)

## 决策

**我们选择了: 选项 C - 混合方案 (更新 /wf_04_ask + 创建 /wf_04_research)**

### 理由

1. **适应不同场景**: 快速决策使用 /wf_04_ask 的基础开源方案调研，深度研究使用 /wf_04_research
2. **工作流分层**: 符合现有工作流的渐进式深度设计，从快速反馈到深度分析
3. **用户友好**: 提供清晰的选择指南，告诉用户何时使用哪个工具
4. **知识积累**: /wf_04_research 生成的对比矩阵更新 KNOWLEDGE.md，建立长期技术选型知识库
5. **Ultrathink 对齐**:
   - **Think Different**: 从默认"自行实现"转变为"优先开源"
   - **Simplify Ruthlessly**: 提供两个工具，分别面对快速和深度场景
   - **Craft, Don't Code**: 强调使用成熟方案而非重复编码

### 关键考量

1. **学习曲线**: 虽然新增命令，但通过明确的"何时使用哪个工具"指南，将复杂度控制在可接受范围
2. **工作流一致性**: 两个工具形成协作关系，而非竞争关系
3. **决策质量**: 混合方案能处理从简单到复杂的各种技术决策
4. **技术栈规范**: 在 CLAUDE.md 中建立正式的"技术选型规范"，确保组织级别的一致性

## 权衡 (Tradeoffs)

### 收益

✅ **质量提升**:
- 系统化的开源方案评估流程
- 避免低质量的自行实现
- 更好的长期可维护性

✅ **知识积累**:
- 技术选型决策持久化到 KNOWLEDGE.md
- 团队能够参考历史决策
- 减少重复性的技术决策讨论

✅ **工作流改进**:
- 架构咨询流程现在包含"开源优先"的明确步骤
- 用户有清晰的指导来进行技术选型
- 决策过程更加规范和可追溯

✅ **时间节约**:
- 对于已有成熟解决方案的需求，集成时间通常小于自行实现
- 预计项目总体开发时间缩短 15-25%（基于技术栈决策占比）

### 成本

💰 **实现成本**: 3.5小时
- 更新 /wf_04_ask.md: 1小时
- 创建 /wf_04_research.md: 2小时
- 更新 CLAUDE.md 添加技术选型规范: 0.5小时

💰 **维护负担**:
- 需要定期更新工具中的开源项目示例
- KNOWLEDGE.md 中的方案对比表需要保持最新
- 预计每月 1-2小时的维护

💰 **学习成本**:
- 新用户需要学习两个相关命令的用途
- 预计学习时间: 15-30分钟

### 风险

⚠️ **工具选择困惑**: 用户可能不知道何时使用 /wf_04_ask vs /wf_04_research
- **缓解**: 在两个命令中都提供清晰的"何时使用我"指南

⚠️ **开源项目质量参差不齐**: 即使采用开源优先策略，也需要进行仔细评估
- **缓解**: /wf_04_research 的详细评估过程帮助识别低质量项目

⚠️ **技术栈不兼容**: 选择的开源方案可能与现有技术栈不兼容
- **缓解**: 在 License 和技术质量维度进行充分评估

⚠️ **社区风险**: 选择的开源项目可能被放弃或失去维护
- **缓解**: /wf_04_research 包含"社区活跃度"评估，重点关注贡献者多样性和更新频率

**监控指标**:
- 采用开源方案的项目数
- 用户对工作流的满意度
- 技术栈决策的变更率

## 后续行动

- [x] 更新 /wf_04_ask.md 添加"开源方案调研"步骤 (2025-11-13)
- [x] 更新 CLAUDE.md 添加"技术选型规范" (2025-11-13)
- [x] 创建 /wf_04_research.md 专门命令 (2025-11-13)
- [ ] 在 KNOWLEDGE.md 中记录本 ADR
- [ ] 更新 PLANNING.md 包含"技术栈决策"模板（当 PLANNING.md 创建时）
- [ ] 收集用户反馈，评估工作流改进效果
- [ ] 根据实际使用情况，定期更新工具和指南

## 重新评估条件

什么情况下应该重新考虑这个决策？

**触发条件**:
1. **使用数据**: 如果 80%+ 的用户只使用 /wf_04_ask 而从不使用 /wf_04_research，考虑合并两个命令
2. **反馈**: 如果用户普遍反映选择工具困惑，考虑简化为单一命令 + 参数
3. **开源生态变化**: 如果发现开源方案质量持续下降，可能需要调整优先级
4. **社区反馈**: 团队反映维护成本过高，可能需要简化评估过程
5. **技术演进**: 新的评估工具或框架出现，可能需要更新评估维度

**评估时间**: 3个月后，收集实际使用数据后重新评估

## 参考资源

- `/wf_04_ask.md` - 架构咨询命令（已更新）
- `/wf_04_research.md` - 开源方案深度研究命令（新建）
- `CLAUDE.md` - 技术选型规范（已更新）
- `KNOWLEDGE.md` - 技术选型历史和方案对比表
- `docs/management/PLANNING.md` - 项目技术栈决策（当创建时）

## 历史

| 日期 | 事件 | 备注 |
|------|------|------|
| 2025-11-13 | Proposed | 识别工作流中缺乏开源优先的系统化步骤 |
| 2025-11-13 | Analyzed | 分析三个选项，选择混合方案 |
| 2025-11-13 | Implemented | 实现选项 C：更新 /wf_04_ask + 创建 /wf_04_research + 更新 CLAUDE.md |
| 2025-11-13 | Accepted | 完成实现，记录决策和权衡 |
