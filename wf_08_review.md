---
command: /wf_08_review
phase: "è´¨é‡ä¿è¯"
description: "ä»£ç å®¡æŸ¥åè°ƒå™¨ï¼Œå¤šç»´åº¦è´¨é‡æ£€æŸ¥ï¼Œé›†æˆ Ultrathink è®¾è®¡ä¼˜é›…åº¦è¯„å®¡ï¼Œæ”¯æŒ Serena MCP å¼•ç”¨å®Œæ•´æ€§æ£€æŸ¥"
model: sonnet
prev_commands: [/wf_05_code, /wf_07_test, /wf_09_refactor]
next_commands: [/wf_09_refactor, /wf_11_commit]
mcp_support: ["Serena (è‡ªåŠ¨)", "Sequential-thinking (--think)"]
docs: ["wf_08_review_process.md", "parallel_execution_pattern.md"]

æœ¬å‘½ä»¤æ”¯æŒ MCP æœåŠ¡å™¨å¢å¼ºåŠŸèƒ½ï¼Œæå‡å®¡æŸ¥æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚

### æ”¯æŒçš„ MCP

| MCP | å¯ç”¨æ–¹å¼ | ç”¨é€” | Token ä¼˜åŒ– |
|-----|---------|------|-----------|
| **Serena** | è‡ªåŠ¨ï¼ˆæ£€æµ‹ç¬¦å·ä¿®æ”¹ï¼‰ | ç¬¦å·çº§å¼•ç”¨å®Œæ•´æ€§æ£€æŸ¥ | N/A |
| **Sequential-thinking** | `--think` æ ‡å¿— | ç»“æ„åŒ–å®¡æŸ¥ç­–ç•¥åˆ†æ | N/A |

### å¿«é€Ÿä½¿ç”¨

```bash
# åŸºç¡€å®¡æŸ¥ï¼ˆè‡ªåŠ¨æ¿€æ´» Serenaï¼‰
/wf_08_review

# ç»“æ„åŒ–æ·±åº¦åˆ†æ
/wf_08_review "å¤æ‚é‡æ„" --think

# ç¦ç”¨æ‰€æœ‰ MCPï¼ˆæ€§èƒ½ä¼˜å…ˆï¼‰
/wf_08_review --no-mcp
```

### æ ¸å¿ƒèƒ½åŠ›

**Serena MCP**:
- âœ… è‡ªåŠ¨å‘ç°æ‰€æœ‰ç¬¦å·è°ƒç”¨ç‚¹
- âœ… éªŒè¯ç­¾åå˜æ›´åŒæ­¥æ€§
- âœ… æ£€æµ‹ç ´åæ€§å˜æ›´å’Œæœªæ›´æ–°å¼•ç”¨

**Sequential-thinking MCP**:
- âœ… ç³»ç»ŸåŒ–åˆ†è§£å®¡æŸ¥ç»´åº¦
- âœ… ç»“æ„åŒ–é£é™©è¯„ä¼°
- âœ… ä¼˜å…ˆçº§æ’åºæ”¹è¿›å»ºè®®

**è¯¦ç»†ç¤ºä¾‹å’Œä½¿ç”¨åœºæ™¯**: å‚è§ [Serena MCP ä½¿ç”¨ç¤ºä¾‹](#serena-mcp-ä½¿ç”¨ç¤ºä¾‹ä»£ç å®¡æŸ¥ä¸­çš„å¼•ç”¨å®Œæ•´æ€§æ£€æŸ¥)

---
## æ‰§è¡Œä¸Šä¸‹æ–‡
**è¾“å…¥**: PLANNING.mdæ ‡å‡† + KNOWLEDGE.mdæ¨¡å¼ + ä»£ç   
**è¾“å‡º**: å®¡æŸ¥æŠ¥å‘Š + TASK.mdæ”¹è¿›ä»»åŠ¡  
**ä¾èµ–**: /wf_07_test â†’ **å®¡æŸ¥** â†’ /wf_09_refactor â†’ /wf_11_commit

## Usage
`/wf_08_review <CODE_SCOPE>` - ä»£ç å®¡æŸ¥ï¼Œå¤šç»´åº¦è´¨é‡æ£€æŸ¥

## Your Role
Code Review Coordinator: Quality + Security + Performance + Architecture
## ğŸ¤– Agent æ¨¡å¼åè°ƒç­–ç•¥ (Phase 2 ä¼˜åŒ–)

**ç›®çš„**: å¤šä¸“ä¸šåŒ– review agents å¹¶è¡Œæ‰§è¡Œå…¨é¢ä»£ç å®¡æŸ¥

### ä½¿ç”¨å†³ç­–

| åœºæ™¯ | ç­–ç•¥ | Agents æ•°é‡ |
|------|------|-----------|
| å°æ”¹åŠ¨ï¼ˆ1-2æ–‡ä»¶ï¼‰ | ç›´æ¥å®¡æŸ¥ | 0ï¼ˆä¸» agentï¼‰ |
| ä¸­ç­‰æ”¹åŠ¨ï¼ˆ3-5æ–‡ä»¶ï¼‰ | é¡ºåºå®¡æŸ¥ | 0-2 |
| å¤§è§„æ¨¡æ”¹åŠ¨ï¼ˆ5+æ–‡ä»¶ï¼‰ | å¹¶è¡Œå®¡æŸ¥ | 4 agents |
| å¤æ‚é‡æ„ | å¹¶è¡Œ+ä¸“ä¸šåŒ– | 4-6 agents |

### å¹¶è¡Œå®¡æŸ¥æ¨¡å¼ (Parallel Review Pattern)

**4-Agent é…ç½®**ï¼ˆæ¨èï¼‰:
1. **Code Quality Reviewer**: ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§
2. **Security Auditor**: å®‰å…¨æ¼æ´å’Œæ•°æ®éªŒè¯
3. **Performance Analyst**: æ€§èƒ½å’Œèµ„æºä¼˜åŒ–
4. **Architecture Assessor**: æ¶æ„ä¸€è‡´æ€§å’Œè®¾è®¡æ¨¡å¼

**æ€§èƒ½æå‡**: 2-3x æ—¶é—´èŠ‚çœï¼ˆvs é¡ºåºå®¡æŸ¥ï¼‰

**è¯¦ç»†ç­–ç•¥ã€ç¤ºä¾‹å’Œæœ€ä½³å®è·µ**: å‚è§ [å¹¶è¡Œæ‰§è¡Œæ¨¡å¼æŒ‡å—](docs/guides/parallel_execution_pattern.md)

---
## âš¡ å¹¶è¡Œæ‰§è¡Œæ¨¡å¼ (NEW - Phase 2 ä¼˜åŒ–)

**ç›®çš„**: é€šè¿‡å¹¶è¡Œè¯»å–å’Œåˆ†æå¤§å¹…æå‡å®¡æŸ¥é€Ÿåº¦

**è¯¦ç»†è¯´æ˜**: å®Œæ•´çš„å¹¶è¡Œæ‰§è¡Œæ¨¡å¼æ–‡æ¡£è¯·å‚è€ƒ [docs/guides/parallel_execution_pattern.md](docs/guides/parallel_execution_pattern.md)

### å¿«é€Ÿå‚è€ƒ

**æ ¸å¿ƒæ¨¡å¼**: Wave â†’ Checkpoint â†’ Wave

**é€‚ç”¨åœºæ™¯**ï¼ˆä»£ç å®¡æŸ¥ç‰¹å®šï¼‰:
- âœ… å®¡æŸ¥ä¿®æ”¹æ¶‰åŠ â‰¥5 ä¸ªæ–‡ä»¶
- âœ… éœ€è¦å¤šç»´åº¦å…¨é¢å®¡æŸ¥ï¼ˆå®‰å…¨ + æ€§èƒ½ + æ¶æ„ï¼‰
- âœ… å¤§è§„æ¨¡é‡æ„å®¡æŸ¥

**æ€§èƒ½æå‡**: å¹³å‡ **3.0-3.5x** æ—¶é—´èŠ‚çœ

**å®æ–½æ–¹å¼**:
1. Wave 1: å¹¶è¡Œè¯»å–æ‰€æœ‰ä¿®æ”¹æ–‡ä»¶
2. Checkpoint: å®¡æŸ¥èŒƒå›´åˆ†æå’Œç»´åº¦ç¡®å®š
3. Wave 2: å¹¶è¡Œç»´åº¦å®¡æŸ¥ï¼ˆä½¿ç”¨ 4 ä¸ª review agentsï¼‰
4. Final: ç»“æœåˆå¹¶å’Œç¬¦å·å®Œæ•´æ€§æ£€æŸ¥ï¼ˆå¦‚é€‚ç”¨ï¼‰

**è¯¦ç»†æ¨¡å¼ã€ç¤ºä¾‹å’Œæ€§èƒ½å¯¹æ¯”**: å‚è§ [å¹¶è¡Œæ‰§è¡Œæ¨¡å¼æŒ‡å—](docs/guides/parallel_execution_pattern.md)

---

**ç›®çš„**: ç¡®ä¿ä»£ç å®¡æŸ¥å‘½ä»¤åœ¨è€ç‰ˆæœ¬ Claude Code éƒ¨ç½²ç¯å¢ƒä¸­æ­£å¸¸å·¥ä½œ

**æ‰§è¡Œæ—¶æœº**: åœ¨ Phase 1 åŸºç¡€ä»£ç å®¡æŸ¥ä¹‹å‰
## ğŸ”§ Environment Compatibility Check

**è‡ªåŠ¨æ£€æµ‹**: Task tool, Serena MCP, Explore agent å¯ç”¨æ€§

### æ‰§è¡Œæ¨¡å¼

| å¯ç”¨å·¥å…· | æ¨¡å¼ | å®¡æŸ¥æ—¶é—´ | å‘ç°ç‡ |
|---------|------|---------|--------|
| å…¨éƒ¨å¯ç”¨ | Scenario A (å®Œå…¨æ”¯æŒ) | ~15min | 90% |
| Task ä¸å¯ç”¨ | Scenario B (åŸºç¡€å®¡æŸ¥) | ~20min | 70% |

### ğŸ“ æ–‡æ¡£è¯»å–ä¿æŠ¤ (MANDATORY)

**å…³é”®è§„åˆ™**: è¯»å–æŒ‡å—æ–‡æ¡£å‰å¿…é¡»ä½¿ç”¨ DocLoader

```python
from commands.lib.doc_loader import DocLoader
doc_loader = DocLoader()

# å¤§æ–‡æ¡£ï¼ˆ>300è¡Œï¼‰ï¼šä½¿ç”¨ç« èŠ‚æ¨¡å¼
content = doc_loader.load_sections("docs/guides/large_guide.md", sections=["Step 2"])

# å°æ–‡æ¡£ï¼ˆ<300è¡Œï¼‰ï¼šå¯ç›´æ¥è¯»å–
```

**ä¿æŠ¤åŸå› **: é˜²æ­¢ä¸Šä¸‹æ–‡çˆ†ç‚¸ï¼ˆå•æ¬¡è¯»å–å¯æ¶ˆè€— 3000-6000 tokensï¼‰

---
## Process

**è¯¦ç»†æ‰§è¡Œæµç¨‹**: å®Œæ•´çš„å®¡æŸ¥æµç¨‹ã€æ­¥éª¤è¯´æ˜å’Œå†³ç­–æ ‘è¯·å‚è€ƒ [ä»£ç å®¡æŸ¥è¯¦ç»†æµç¨‹æŒ‡å—](docs/guides/wf_08_review_process.md)

### å¿«é€Ÿæµç¨‹æ¦‚è§ˆ

```
Step 0: ç¯å¢ƒå…¼å®¹æ€§æ£€æŸ¥
  â†“
Step 1: å®¡æŸ¥å‡†å¤‡
  â”œâ”€ Step 1.1: æ™ºèƒ½å˜æ›´è¯†åˆ« (Explore Agent)
  â”œâ”€ Step 1.2: ä¸Šä¸‹æ–‡åŠ è½½
  â”œâ”€ Step 1.3: å®¡æŸ¥èŒƒå›´ç¡®å®š
  â””â”€ Step 1.4: ç¬¦å·çº§ä¿®æ”¹æ£€æµ‹ (Serena MCP)
  â†“
Step 2: å®¡æŸ¥æ‰§è¡Œæ¨¡å¼é€‰æ‹©
  â”œâ”€ Mode A: é¡ºåºå®¡æŸ¥ (<5 æ–‡ä»¶)
  â””â”€ Mode B: å¹¶è¡Œå®¡æŸ¥ (â‰¥5 æ–‡ä»¶, 2-3x æ€§èƒ½)
  â†“
Step 2.5: æŒ‰éœ€åŠ è½½è§„èŒƒæ–‡æ¡£ (DocLoader)
  â†“
Step 3: å‘ç°ç»¼åˆå’Œè¡ŒåŠ¨è§„åˆ’
  â”œâ”€ é—®é¢˜åˆ†ç±»å’Œä¼˜å…ˆçº§
  â”œâ”€ Ultrathink è®¾è®¡ä¼˜é›…åº¦è¯„å®¡
  â””â”€ ç”Ÿæˆæ”¹è¿›ä»»åŠ¡
  â†“
Step 4: è¾“å‡ºç”Ÿæˆ
```

### å…³é”®å†³ç­–ç‚¹

**ä½•æ—¶ä½¿ç”¨ Explore Agent**:
- âœ… å˜æ›´èŒƒå›´ä¸æ˜ç¡®ï¼ˆè¯†åˆ«æ‰€æœ‰ä¿®æ”¹æ–‡ä»¶ï¼‰
- âœ… å¤§è§„æ¨¡æ”¹åŠ¨ï¼ˆ5+ æ–‡ä»¶ï¼‰
- âŒ å®¡æŸ¥èŒƒå›´å·²æ˜ç¡®ï¼ˆè·³è¿‡ä»¥èŠ‚çœæ—¶é—´ï¼‰

**ä½•æ—¶ä½¿ç”¨å¹¶è¡Œå®¡æŸ¥**:
- âœ… â‰¥5 ä¸ªç‹¬ç«‹æ–‡ä»¶éœ€è¦å®¡æŸ¥
- âœ… å¤šç»´åº¦å®¡æŸ¥ï¼ˆå®‰å…¨+æ€§èƒ½+æ¶æ„ï¼‰
- âŒ <5 ä¸ªæ–‡ä»¶ï¼ˆé¡ºåºå®¡æŸ¥æ›´ç®€æ´ï¼‰

**è¯¦ç»†æ­¥éª¤ã€ç¤ºä¾‹å’Œæœ€ä½³å®è·µ**: å‚è§ [ä»£ç å®¡æŸ¥è¯¦ç»†æµç¨‹æŒ‡å—](docs/guides/wf_08_review_process.md)

---
## Output Format

**è¯¦ç»†è¾“å‡ºæ ¼å¼**: å®Œæ•´çš„è¾“å‡ºç»“æ„ã€ç¤ºä¾‹å’Œæ ¼å¼è§„èŒƒè¯·å‚è€ƒ [ä»£ç å®¡æŸ¥è¯¦ç»†æµç¨‹æŒ‡å—](docs/guides/wf_08_review_process.md#è¾“å‡ºæ ¼å¼)

### æ ‡å‡†è¾“å‡ºç»“æ„

```markdown
# ä»£ç å®¡æŸ¥æŠ¥å‘Š

## ğŸ“‹ å®¡æŸ¥æ¦‚è§ˆ
- å®¡æŸ¥èŒƒå›´ã€å½±å“æ–‡ä»¶æ•°ã€å¤æ‚åº¦è¯„ä¼°

## ğŸ” Dimension 1: ä»£ç è´¨é‡
- è¯„åˆ†ã€ä¸»è¦é—®é¢˜ã€æ”¹è¿›å»ºè®®

## ğŸ”’ Dimension 2: å®‰å…¨æ€§
- è¯„åˆ†ã€å®‰å…¨é—®é¢˜ã€ä¿®å¤ä¼˜å…ˆçº§

## âš¡ Dimension 3: æ€§èƒ½
- è¯„åˆ†ã€æ€§èƒ½ç“¶é¢ˆã€ä¼˜åŒ–å»ºè®®

## ğŸ“ Dimension 4: æ¶æ„
- è¯„åˆ†ã€æ¶æ„é—®é¢˜ã€è®¾è®¡å»ºè®®

## ğŸ“š Dimension 5: æ–‡æ¡£
- è¯„åˆ†ã€æ–‡æ¡£ç¼ºå£ã€æ”¹è¿›å»ºè®®

## ğŸ¨ Dimension 6: è®¾è®¡ä¼˜é›…åº¦ (Ultrathink)
- Obsess Over Details è§†è§’è¯„ä¼°

## ğŸ“ æ”¹è¿›ä»»åŠ¡æ¸…å•
- è‡ªåŠ¨ç”Ÿæˆçš„ TASK.md æ›´æ–°é¡¹

## âœ… è‡ªæ£€æ¸…å•
- å®¡æŸ¥å®Œæ•´æ€§éªŒè¯
```

**è¯¦ç»†æ ¼å¼è§„èŒƒã€è¯„åˆ†æ ‡å‡†å’Œç¤ºä¾‹**: å‚è§ [å®¡æŸ¥æµç¨‹æŒ‡å—](docs/guides/wf_08_review_process.md)

---
## ğŸ”§ Serena MCP ä½¿ç”¨ç¤ºä¾‹ï¼ˆä»£ç å®¡æŸ¥ä¸­çš„å¼•ç”¨å®Œæ•´æ€§æ£€æŸ¥ï¼‰

### è‡ªåŠ¨æ¿€æ´»åœºæ™¯

Serena MCP åœ¨æ£€æµ‹åˆ°ä»¥ä¸‹ç¬¦å·ä¿®æ”¹æ—¶è‡ªåŠ¨æ¿€æ´»ï¼š
- âœ… å‡½æ•°/æ–¹æ³•é‡å‘½å
- âœ… API æ¥å£ç­¾åå˜æ›´
- âœ… ç±»é‡æ„å’Œæˆå‘˜ä¿®æ”¹

### æ ¸å¿ƒèƒ½åŠ›

| èƒ½åŠ› | æ•ˆæœ | æ—¶é—´èŠ‚çœ |
|------|------|---------|
| ç¬¦å·å¼•ç”¨å‘ç° | å®šä½æ‰€æœ‰è°ƒç”¨ç‚¹ | 60-80% |
| é—æ¼æ£€æµ‹ | å‘ç°æœªæ›´æ–°å¼•ç”¨ | å‡†ç¡®æ€§ 60% â†’ 90% |
| å½±å“è¯„ä¼° | è¯„ä¼°å˜æ›´å½±å“èŒƒå›´ | è‡ªåŠ¨åŒ–åˆ†æ |

### å…¸å‹ä½¿ç”¨

```bash
# åŸºç¡€å®¡æŸ¥ï¼ˆè‡ªåŠ¨æ¿€æ´»ï¼‰
/wf_08_review

# Serena è‡ªåŠ¨æ‰§è¡Œ:
1. æ£€æµ‹ç¬¦å·ä¿®æ”¹ï¼ˆé‡å‘½åã€ç­¾åå˜æ›´ç­‰ï¼‰
2. æŸ¥æ‰¾æ‰€æœ‰å¼•ç”¨ç‚¹ (find_referencing_symbols)
3. éªŒè¯å¼•ç”¨å®Œæ•´æ€§
4. ç”Ÿæˆé—®é¢˜æŠ¥å‘Šå’Œæ”¹è¿›å»ºè®®
```

**è¯¦ç»†åœºæ™¯å’Œç¤ºä¾‹**: å‚è§ MCP ç« èŠ‚å’Œ [Serena ä½¿ç”¨æŒ‡å—](docs/guides/wf_08_review_serena_guide.md)

---
## Workflow Integration
- Enforces PLANNING.md standards
- Leverages patterns from KNOWLEDGE.md
- Contributes new patterns to KNOWLEDGE.md
- Generates tasks in TASK.md
- Gates `/wf_11_commit` readiness
- May trigger `/wf_09_refactor`
- Updates quality metrics
- **[Serena MCP Integration]**: Conditional activation for symbol-level change verification
  - Automatically detects symbol-level modifications (function rename, class changes, method signature changes)
  - Uses `find_referencing_symbols()` to verify all call sites updated consistently
  - Improves code review coverage: 60% â†’ 90% issue detection rate
  - Saves 60-80% review time for changes involving symbol modifications

## ğŸ“Œ å·¥ä½œæµå¯¼èˆª (Phase 3 - é—­ç¯å·¥ä½œæµ)

### å‰ç½®å‘½ä»¤
- `/wf_05_code` â†’ å®ç°åŠŸèƒ½åå®¡æŸ¥ä»£ç è´¨é‡
- `/wf_07_test` â†’ æµ‹è¯•å®Œæˆåå®¡æŸ¥è¦†ç›–ç‡å’Œè´¨é‡
- `/wf_09_refactor` â†’ é‡æ„åéªŒè¯æ”¹è¿›æ•ˆæœ

### åç»­å‘½ä»¤

**å®¡æŸ¥é€šè¿‡** â†’ `/wf_11_commit` (æäº¤ä»£ç )
**å‘ç°é—®é¢˜** â†’ `/wf_09_refactor` (é‡æ„æ”¹è¿›)
**éœ€è¦æµ‹è¯•** â†’ `/wf_07_test` (è¡¥å……æµ‹è¯•)
**é‡å¤§é—®é¢˜** â†’ `/wf_06_debug` (æ·±åº¦è°ƒè¯•)

### å…¸å‹å·¥ä½œæµ

```
åŠŸèƒ½å¼€å‘æµç¨‹:
  /wf_05_code â†’ /wf_07_test â†’ /wf_08_review â†’ /wf_11_commit

è´¨é‡æ”¹è¿›æµç¨‹:
  /wf_08_review â†’ /wf_09_refactor â†’ /wf_08_review (å†å®¡æŸ¥) â†’ /wf_11_commit

Bugä¿®å¤æµç¨‹:
  /wf_06_debug â†’ /wf_07_test â†’ /wf_08_review â†’ /wf_11_commit
```

---
